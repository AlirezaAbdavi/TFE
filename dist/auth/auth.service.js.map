{"version":3,"sources":["../../src/auth/auth.service.ts"],"sourcesContent":["import { Injectable, UnauthorizedException } from '@nestjs/common';\r\nimport { UsersService } from '../users/users.service';\r\nimport { JwtService } from '@nestjs/jwt';\r\nimport * as bcrypt from 'bcrypt';\r\n\r\n@Injectable()\r\nexport class AuthService {\r\n  constructor(\r\n    private usersService: UsersService,\r\n    private jwtService: JwtService,\r\n  ) {}\r\n\r\n  // ۱. بررسی صحت نام کاربری و رمز عبور\r\n  async signIn(email: string, pass: string): Promise<any> {\r\n    // پیدا کردن کاربر از طریق سرویس کاربران\r\n    const user = await this.usersService.findOneByEmail(email);\r\n\r\n    // نکته: ما هنوز findOneByEmail را در UsersService نساختیم! (بعدا می‌سازیم)\r\n\r\n    // مقایسه پسورد خام (pass) با پسورد هش شده در دیتابیس (user.password)\r\n    if (user && (await bcrypt.compare(pass, user.password))) {\r\n      return user;\r\n    }\r\n\r\n    throw new UnauthorizedException('اطلاعات ورود اشتباه است');\r\n  }\r\n\r\n  // ۲. تولید توکن برای کاربر لاگین شده\r\n  async login(user: any) {\r\n    const payload = { email: user.email, sub: user._id }; // اطلاعات داخل توکن\r\n    return {\r\n      access_token: this.jwtService.sign(payload), // تولید امضا\r\n    };\r\n  }\r\n}\r\n"],"names":["AuthService","signIn","email","pass","user","usersService","findOneByEmail","bcrypt","compare","password","UnauthorizedException","login","payload","sub","_id","access_token","jwtService","sign"],"mappings":";;;;+BAMaA;;;eAAAA;;;wBANqC;8BACrB;qBACF;gEACH;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAGjB,IAAA,AAAMA,cAAN,MAAMA;IAMX,qCAAqC;IACrC,MAAMC,OAAOC,KAAa,EAAEC,IAAY,EAAgB;QACtD,wCAAwC;QACxC,MAAMC,OAAO,MAAM,IAAI,CAACC,YAAY,CAACC,cAAc,CAACJ;QAEpD,2EAA2E;QAE3E,qEAAqE;QACrE,IAAIE,QAAS,MAAMG,QAAOC,OAAO,CAACL,MAAMC,KAAKK,QAAQ,GAAI;YACvD,OAAOL;QACT;QAEA,MAAM,IAAIM,6BAAqB,CAAC;IAClC;IAEA,qCAAqC;IACrC,MAAMC,MAAMP,IAAS,EAAE;QACrB,MAAMQ,UAAU;YAAEV,OAAOE,KAAKF,KAAK;YAAEW,KAAKT,KAAKU,GAAG;QAAC,GAAG,oBAAoB;QAC1E,OAAO;YACLC,cAAc,IAAI,CAACC,UAAU,CAACC,IAAI,CAACL;QACrC;IACF;IA1BA,YACE,AAAQP,YAA0B,EAClC,AAAQW,UAAsB,CAC9B;aAFQX,eAAAA;aACAW,aAAAA;IACP;AAwBL"}